# Experiment Template for Roboratory Monorepo

This is a template showing how to structure a new experiment in the roboratory workspace.

## Quick Start

Copy the `exp-2026-01-starter` folder structure or follow these steps:

### 1. Create Your Experiment Folder

```bash
mkdir experiments/my-awesome-experiment
cd experiments/my-awesome-experiment
```

### 2. Add `package.json`

```json
{
  "name": "my-awesome-experiment",
  "version": "1.0.0",
  "description": "Brief description of what this experiment does",
  "private": true,
  "scripts": {
    "dev": "ts-node index.ts",
    "build": "tsc",
    "test": "jest"
  },
  "dependencies": {
    "axios": "^1.6.2"
  },
  "devDependencies": {
    "@types/node": "^20.10.6",
    "ts-node": "^10.9.2",
    "typescript": "^5.3.3"
  }
}
```

### 3. Add `tsconfig.json`

```json
{
  "extends": "../../tsconfig.json",
  "compilerOptions": {
    "outDir": "./dist",
    "rootDir": "."
  },
  "include": ["."],
  "exclude": ["node_modules"]
}
```

### 4. Add Your Code Files

```bash
# Create your main file
touch index.ts

# Or create a src directory for larger projects
mkdir src
touch src/main.ts
```

### 5. Install Dependencies

From the **root of the monorepo** (not the experiment folder!):

```bash
pnpm install
```

### 6. Run Your Experiment

```bash
# From root with filter
pnpm --filter my-awesome-experiment run dev

# Or from the experiment directory
cd experiments/my-awesome-experiment
pnpm run dev
```

## File Structure Examples

### Simple Experiment (Single File)

```
my-experiment/
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ README.md
â””â”€â”€ index.ts
```

### Larger Experiment (With Source Directory)

```
my-experiment/
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ README.md
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.ts
â”‚   â”œâ”€â”€ utils.ts
â”‚   â””â”€â”€ types.ts
â”œâ”€â”€ dist/          (generated by `tsc`)
â””â”€â”€ node_modules/  (DON'T CREATE - uses root node_modules)
```

### Experiment with Tests

```
my-experiment/
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ jest.config.js (extends root)
â”œâ”€â”€ README.md
â”œâ”€â”€ src/
â”‚   â””â”€â”€ main.ts
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ main.test.ts
â””â”€â”€ dist/
```

## Important Notes

### âœ… DO

- Create `package.json` with only the dependencies YOUR experiment needs
- Extend `tsconfig.json` from the root (`"extends": "../../tsconfig.json"`)
- Use `pnpm` commands (never `npm`)
- Run `pnpm install` from the root directory
- Add meaningful scripts (`dev`, `build`, `test`)
- Update the root monorepo `pnpm-lock.yaml` by running `pnpm install`

### âŒ DON'T

- Create a local `node_modules` folder
- Create a local lock file (`package-lock.json`, `.pnpm-lock.yaml`)
- Run `npm install` or `pnpm install` inside the experiment
- Ignore the `pnpm-workspace.yaml` config at root
- Create duplicate dependencies in your package.json if they're already at root

## Using Shared Packages

If your experiment needs a package from `packages/`, you can reference it:

```json
{
  "dependencies": {
    "@roboratory/db-sqlite": "workspace:packages/db-sqlite"
  }
}
```

Then run `pnpm install` from root to link it.

## Running Multiple Experiments

From root, run scripts across all experiments:

```bash
# Run 'dev' in all experiments
pnpm --filter "./experiments/*" run dev

# Run 'build' in all experiments
pnpm --filter "./experiments/*" run build
```

## Adding Dependencies Later

If you need a new dependency:

```bash
# From the experiment directory
cd experiments/my-experiment
pnpm add some-package

# Or from root with filter
pnpm --filter my-awesome-experiment add some-package
```

Then run `pnpm install` from root to update the lock file.

## Example: Simple API Client Experiment

```typescript
// index.ts
import axios from 'axios';

async function main() {
  try {
    const response = await axios.get('https://api.example.com/data');
    console.log('Data:', response.data);
  } catch (error) {
    console.error('Error:', error.message);
  }
}

main();
```

Run with: `pnpm run dev`

## Debugging Issues

### "Cannot find module X"

Make sure you ran `pnpm install` from the root:

```bash
cd ../../
pnpm install
```

### "ts-node command not found"

Run scripts through pnpm:

```bash
# âœ… Correct
pnpm run dev

# âŒ Wrong - using ts-node directly
ts-node index.ts
```

### Path issues with imports

Use the extended `tsconfig.json` to ensure proper resolution:

```bash
pnpm run build  # Builds with correct config
```

## Next Steps

1. Read the main [MONOREPO_SETUP.md](../../MONOREPO_SETUP.md) for more details
2. Check out [experiments/tagged-music](../tagged-music/README.md) as a real-world example
3. Start coding! ğŸš€

---

**Remember**: The entire monorepo shares one `node_modules` at the root. This saves disk space and makes dependency management centralized!
